var api = require("../");

var config = {
	host:"192.168.30.11",
	port: 3000,
	credentials:{"id":"5555a13aeb1f3e1f012b5db7","key":"I6N~o_eKzlCvQKbqxppxH-D4Hit6f5ynhnF13kFa"}
}

api.initialize(config,function(data){
	if(data.success){
		m = process.MEDITAB();
		console.log("MEDITAB API SDK POINTED AT "+ m.host+":"+m.port);

		// do an ajax request sample
		setTimeout(function(){
			var conf = {
				method: "get",
				path: "/appuser/list",
				params:[
					{
						key:"populate",
						value: "profileId"
					},
					{
						key:"populate",
						value: "companyId"
					},
					{
						key: "limit",
						value: 10
					}
				]
			}
			api
			.http(conf)
			.then(function(data){
				console.log("SUCCESS",data.length);
			})
			.catch(function(error){
				console.log("FAILED",error);
			})

		},100);

		setTimeout(function(){
			var USER = new api.model("appuser");

			USER.find({id:1448})
			.exec(function(err,data){
				if(err){
					console.log(err);
				}else{
					console.log("USER FOUND",data);
				}
			})

			USER.show(1448)
			.populate("profileId")
			.populate("companyId")
			.exec(function(err,data){
				if(err){
					console.log(err);
				}else{
					console.log("USER FOUND 2",data)
				}
			})
		},1000)

		setTimeout(function(){
			var data;
			data = {
				email: "neilm@meditab.com",
				password: "test",
				strategy: "local"
			}
			api.login(data, function(err, res){
				if(err){
					console.log(err);
				}else{
					console.log("Validated", res)
				}
			})
		},1000)


		setTimeout(function(){
			var session = {
				appuser: 123
			}
			api.renew(session, function (result) {
				console.log(result, 'done');
				// data key to return to front end is result.data
			});
		},1000)
	}
});
